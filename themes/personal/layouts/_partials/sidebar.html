{{- /*
Sidebar: Tags (sorted by count) + Archive (year → month → posts).

Tags link directly to Hugo's term pages (/tags/<name>/).
Archive links navigate to /posts/ with ?year= and ?year=&month= query
params; client-side JS in main.js filters the post cards accordingly.
*/}}

<aside class="sidebar">

  {{- /* ── Tags ── */}}
  {{- with site.Taxonomies.tags }}
  <div class="sidebar-panel">
    <h3>Tags</h3>
    <ul class="sidebar-tags">
      {{- range .ByCount }}
        <li>
          <a href="{{ .Page.RelPermalink }}">{{ .Page.LinkTitle }} <span class="tag-count">{{ .Count }}</span></a>
        </li>
      {{- end }}
    </ul>
  </div>
  {{- end }}

  {{- /* ── Archive ── */}}
  {{- with site.RegularPages }}
  <div class="sidebar-panel">
    <h3>Archive</h3>
    <ul class="archive-years">
      {{- range .GroupByDate "2006" }}
        {{- $year := .Key }}
        <li>
          <details>
            <summary>
              <a href="/posts/?year={{ $year }}" class="archive-link">{{ $year }}</a>
              <span class="archive-count">{{ len .Pages }}</span>
            </summary>
            <ul class="archive-months">
              {{- range .Pages.GroupByDate "January 2006" }}
                {{- /* Derive month number from the first page's date */}}
                {{- $firstPage := index .Pages 0 }}
                {{- $monthNum  := $firstPage.Date | time.Format "1" }}
                {{- $monthName := $firstPage.Date | time.Format "January" }}
                <li>
                  <details>
                    <summary>
                      <a href="/posts/?year={{ $year }}&amp;month={{ $monthNum }}" class="archive-link">{{ $monthName }}</a>
                      <span class="archive-count">{{ len .Pages }}</span>
                    </summary>
                    <ul class="archive-posts">
                      {{- range .Pages }}
                        <li><a href="{{ .RelPermalink }}" class="archive-link">{{ .LinkTitle }}</a></li>
                      {{- end }}
                    </ul>
                  </details>
                </li>
              {{- end }}
            </ul>
          </details>
        </li>
      {{- end }}
    </ul>
  </div>
  {{- end }}

</aside>
